<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Your Cart | Attral Store</title>
  <meta name="description" content="View and manage your shopping cart." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a class="logo" href="index.html"><img src="logo.png" alt="ATTRAL" style="height:32px; width:auto;" /></a>
      <nav class="nav">
        <a href="index.html">Home</a>
        <a href="shop.html">Shop</a>
        <a href="account.html">My Account</a>
        <a href="affiliates.html">Affiliate Central</a>
        <a href="contact.html">Contact Us</a>
        <div class="dropdown">
          <a href="#" class="dropdown-toggle">More ‚ñæ</a>
          <div class="dropdown-menu">
            <a href="about.html">About Us</a>
            <a href="blog.html" target="_blank" rel="noopener">Blog</a>
            <a href="privacy.html">Privacy</a>
            <a href="terms.html">Terms</a>
          </div>
        </div>
        <a href="cart.html" class="cart-link active">Cart <span id="cart-count" class="badge">0</span></a>
      </nav>
    </div>
  </header>

  <main class="container">
    <!-- Cart Hero Section -->
    <section class="cart-hero">
      <div class="cart-hero-content">
        <div class="cart-hero-icon">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M7 4V2C7 1.45 7.45 1 8 1H16C16.55 1 17 1.45 17 2V4H20C20.55 4 21 4.45 21 5S20.55 6 20 6H19V19C19 20.1 18.1 21 17 21H7C5.9 21 5 20.1 5 19V6H4C3.45 6 3 5.55 3 5S3.45 4 4 4H7ZM9 3V4H15V3H9ZM7 6V19H17V6H7Z" fill="currentColor"/>
            <path d="M9 8V17H11V8H9ZM13 8V17H15V8H13Z" fill="currentColor"/>
          </svg>
        </div>
        <h1 class="cart-hero-title">Your Shopping Cart</h1>
        <p class="cart-hero-subtitle">Review your items and proceed to checkout</p>
      </div>
    </section>

    <!-- Cart Content -->
    <section class="cart-section">
      <div id="cart-container" class="cart"></div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container footer-inner">
      <div class="footer-content">
        <div class="footer-section">
          <h4>About ATTRAL</h4>
          <p>Smart Power. Smarter Living. We provide next-gen consumer electronics to power your lifestyle with cutting-edge GaN technology.</p>
          <div class="social-links">
            <a href="https://facebook.com/attral" target="_blank" rel="noopener" title="Follow us on Facebook">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
              </svg>
            </a>
            <a href="https://instagram.com/attral" target="_blank" rel="noopener" title="Follow us on Instagram">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 6.62 5.367 11.987 11.988 11.987s11.987-5.367 11.987-11.987C24.014 5.367 18.637.001 12.017.001zM8.449 16.988c-1.297 0-2.448-.49-3.323-1.297C4.198 14.895 3.708 13.744 3.708 12.447s.49-2.448 1.297-3.323c.875-.807 2.026-1.297 3.323-1.297s2.448.49 3.323 1.297c.807.875 1.297 2.026 1.297 3.323s-.49 2.448-1.297 3.323c-.875.807-2.026 1.297-3.323 1.297zm7.83-9.281H7.83c-.49 0-.89.4-.89.89v7.83c0 .49.4.89.89.89h8.449c0 .49.4.89.89.89v-7.83c0-.49-.4-.89-.89-.89z"/>
              </svg>
            </a>
            <a href="https://twitter.com/attral" target="_blank" rel="noopener" title="Follow us on Twitter">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
              </svg>
            </a>
            <a href="https://linkedin.com/company/attral" target="_blank" rel="noopener" title="Connect on LinkedIn">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
              </svg>
            </a>
          </div>
        </div>
        <div class="footer-section">
          <h4>Quick Links</h4>
          <p><a href="index.html">Home</a></p>
          <p><a href="shop.html">Shop</a></p>
          <p><a href="about.html">About Us</a></p>
          <p><a href="contact.html">Contact</a></p>
        </div>
        <div class="footer-section">
          <h4>Support</h4>
          <p><a href="account.html">My Account</a></p>
          <p><a href="cart.html">Shopping Cart</a></p>
          <p><a href="affiliates.html">Affiliate Program</a></p>
          <p><a href="blog.html" target="_blank" rel="noopener">Blog</a></p>
        </div>
        <div class="footer-section">
          <h4>Contact Info</h4>
          <p>üìß info@attral.in</p>
          <p>üì± +91 8903479870</p>
          <p>üìç Phase 2 Sathuvachari<br>Vellore - 632009<br>Tamil Nadu, India</p>
        </div>
      </div>
      <div class="footer-bottom">
        <p>¬© <span id="year"></span> ATTRAL. All rights reserved.</p>
        <nav>
          <a href="privacy.html">Privacy Policy</a>
          <a href="terms.html">Terms of Service</a>
          <a href="sitemap.xml">Sitemap</a>
        </nav>
      </div>
    </div>
  </footer>

  <script src="js/config.js"></script>
  <script src="js/app.js"></script>
  <script src="js/firebase.js"></script>
  <script src="js/dropdown.js"></script>
  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    function waitForAttral(maxMs = 5000) {
      return new Promise(resolve => {
        const start = Date.now();
        const t = setInterval(() => {
          if (window.Attral) {
            clearInterval(t);
            resolve(true);
          } else if (Date.now() - start > maxMs) {
            clearInterval(t);
            resolve(false);
          }
        }, 100);
      });
    }

    async function renderCartFallback(targetId) {
      const el = document.getElementById(targetId);
      try {
        const raw = localStorage.getItem('attral_cart');
        const cart = raw ? JSON.parse(raw) : [];
        if (!cart.length) {
          el.innerHTML = '<div style="padding:2rem; color:#6b7280;">Your cart is empty.</div>';
        } else {
          // Load current prices from products.json
          let currentPrices = {};
          try {
            const response = await fetch('data/products.json');
            const products = await response.json();
            products.forEach(product => {
              // Map both numeric ID and slug ID to current price
              currentPrices[product.id] = product.price;
              const slugId = product.title.toLowerCase().replace(/[^a-z0-9\s-]/g,'').replace(/\s+/g,'-').replace(/-+/g,'-').trim();
              currentPrices[slugId] = product.price;
            });
          } catch (error) {
            console.warn('Failed to load current prices, using stored prices:', error);
          }
          
          const rows = cart.map(i => {
            // Use current price from products.json if available, otherwise fallback to stored price
            const currentPrice = currentPrices[i.id] || i.price || 0;
            const itemTotal = currentPrice * (i.quantity || 1);
            
            return `
              <div style="display:flex; justify-content:space-between; padding:12px 0; border-bottom:1px solid #e5e7eb;">
                <div style="font-weight:600;">${i.title || ('Item #' + i.id)}</div>
                <div style="display:flex; gap:16px; align-items:center;">
                  <div>x${i.quantity || 1}</div>
                  <div>‚Çπ${currentPrice.toLocaleString()}</div>
                  <div style="font-weight:600;">‚Çπ${itemTotal.toLocaleString()}</div>
                </div>
              </div>
            `;
          }).join('');
          
          const total = cart.reduce((s,i) => {
            const currentPrice = currentPrices[i.id] || i.price || 0;
            return s + (currentPrice * (i.quantity || 1));
          }, 0);
          
          el.innerHTML = `
            <div style="margin-bottom:20px;">
              <div style="display:flex; justify-content:space-between; padding:8px 0; font-weight:600; border-bottom:2px solid #e5e7eb;">
                <div>Item</div>
                <div style="display:flex; gap:16px;">
                  <div>Qty</div>
                  <div>Price</div>
                  <div>Total</div>
                </div>
              </div>
              ${rows}
            </div>
            <div style="display:flex; justify-content:space-between; padding:16px 0; font-weight:700; font-size:1.2rem; border-top:2px solid #667eea;">
              <div>Total</div>
              <div>‚Çπ${total.toLocaleString()}</div>
            </div>
            <div style="display:flex; justify-content:flex-end; gap:12px; margin-top:20px;">
              <a href="shop.html" style="padding:10px 16px; border:2px solid #667eea; color:#667eea; border-radius:8px; text-decoration:none; font-weight:600;">Continue Shopping</a>
              <button id="fallback-checkout" style="padding:10px 16px; background:linear-gradient(135deg,#ff6b35,#f7931e); color:#fff; border:none; border-radius:8px; font-weight:700; cursor:pointer;">Checkout</button>
            </div>
          `;
          
          // Setup fallback checkout to order page with current prices
          var btn = document.getElementById('fallback-checkout');
          if (btn) {
            btn.addEventListener('click', function(){
              try {
                const items = cart.map(function(i){ 
                  const currentPrice = currentPrices[i.id] || i.price || 0;
                  return { 
                    id: i.id, 
                    title: i.title, 
                    price: currentPrice, 
                    image: i.image || 'assets/product_images/1.jpeg', 
                    quantity: i.quantity || 1 
                  }; 
                });
                const payload = { items: items, total: total };
                sessionStorage.setItem('cartCheckout', JSON.stringify(payload));
              } catch(e) {}
              window.location.href = 'order.html?type=cart';
            });
          }
        }
      } catch (e) {
        el.innerHTML = '<div style="padding:2rem; color:#ef4444;">Failed to load cart.</div>';
      }
    }

    function updateCartCountFallback() {
      const el = document.getElementById('cart-count');
      try {
        const raw = localStorage.getItem('attral_cart');
        const cart = raw ? JSON.parse(raw) : [];
        const count = cart.reduce((s, i) => s + (i.quantity || 1), 0);
        el.textContent = count;
      } catch {
        el.textContent = '0';
      }
    }

    (async function init() {
      const hasAttral = await waitForAttral();
      if (hasAttral) {
        try { window.Attral.initHeaderCartCount(); } catch {}
        try { window.Attral.renderCart('cart-container').catch(() => renderCartFallback('cart-container')); } catch { renderCartFallback('cart-container'); }
      } else {
        updateCartCountFallback();
        renderCartFallback('cart-container');
      }
    })();
  </script>
</body>
</html>


