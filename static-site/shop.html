<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shop | ATTRAL - Premium Electronics Store</title>
  <meta name="description" content="Discover our premium collection of electronics. Fast charging solutions, smart devices, and cutting-edge technology for modern life." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css" />
  <link rel="stylesheet" href="css/product.css" />
  
  <!-- Enhanced Shop Page Styles -->
  <style>
    /* Shop Page Hero Section */
    .shop-hero {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 100px 0 80px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    
    .shop-hero::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.05"/><circle cx="10" cy="60" r="0.5" fill="white" opacity="0.05"/><circle cx="90" cy="40" r="0.5" fill="white" opacity="0.05"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
      opacity: 0.3;
    }
    
    .shop-hero h1 {
      font-size: 4rem;
      font-weight: 800;
      margin-bottom: 1.5rem;
      text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      position: relative;
      z-index: 2;
    }
    
    .shop-hero p {
      font-size: 1.5rem;
      opacity: 0.9;
      max-width: 700px;
      margin: 0 auto 2rem;
      position: relative;
      z-index: 2;
    }
    
    .shop-stats {
      display: flex;
      justify-content: center;
      gap: 3rem;
      margin-top: 3rem;
      position: relative;
      z-index: 2;
    }
    
    .shop-stat {
      text-align: center;
    }
    
    .shop-stat-number {
      font-size: 2.5rem;
      font-weight: 800;
      display: block;
      margin-bottom: 0.5rem;
    }
    
    .shop-stat-label {
      font-size: 1rem;
      opacity: 0.8;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    /* Products Grid Section */
    .products-section {
      padding: 80px 0;
      background: linear-gradient(145deg, #f8fafc, #ffffff);
    }
    
    .products-header {
      text-align: center;
      margin-bottom: 4rem;
    }
    
    .products-header h2 {
      font-size: 3rem;
      font-weight: 800;
      color: #1f2937;
      margin-bottom: 1rem;
    }
    
    .products-header p {
      font-size: 1.25rem;
      color: #6b7280;
      max-width: 600px;
      margin: 0 auto;
    }
    
    /* Products Grid */
    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 2rem;
      margin-bottom: 4rem;
    }
    
    .product-card {
      background: white;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      cursor: pointer;
    }
    
    .product-card:hover {
      transform: translateY(-10px) scale(1.02);
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
    }
    
    .product-image-container {
      position: relative;
      height: 300px;
      overflow: hidden;
      background: linear-gradient(145deg, #f8fafc, #ffffff);
    }
    
    .product-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: all 0.4s ease;
    }
    
    .product-card:hover .product-image {
      transform: scale(1.1);
    }
    
    .product-badge {
      position: absolute;
      top: 15px;
      left: 15px;
      background: linear-gradient(135deg, #ff6b35, #f7931e);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.875rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
    }
    
    
    .product-info {
      padding: 2rem;
    }
    
    .product-category {
      font-size: 0.875rem;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 0.5rem;
    }
    
    .product-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 0.75rem;
      line-height: 1.3;
    }
    
    .product-description {
      font-size: 1rem;
      color: #6b7280;
      line-height: 1.6;
      margin-bottom: 1.5rem;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .product-price {
      font-size: 2rem;
      font-weight: 800;
      color: #ff6b35;
      margin-bottom: 1.5rem;
    }
    
    .product-features {
      margin-bottom: 1.5rem;
    }
    
    .product-features ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .product-features li {
      font-size: 0.875rem;
      color: #4b5563;
      margin-bottom: 0.5rem;
      padding-left: 1.5rem;
      position: relative;
    }
    
    .product-features li::before {
      content: '✓';
      position: absolute;
      left: 0;
      color: #10b981;
      font-weight: bold;
    }
    
    .product-actions {
      display: flex;
      gap: 1rem;
    }
    
    .btn-add-cart {
      flex: 1;
      background: linear-gradient(135deg, #ff6b35, #f7931e);
      color: white;
      border: none;
      padding: 14px 24px;
      border-radius: 12px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn-add-cart:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(255, 107, 53, 0.4);
    }
    
    .btn-view-details {
      background: transparent;
      color: #667eea;
      border: 2px solid #667eea;
      padding: 14px 24px;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn-view-details:hover {
      background: #667eea;
      color: white;
      transform: translateY(-2px);
    }
    
    /* Loading States */
    .loading {
      opacity: 0.7;
      pointer-events: none;
    }
    
    .loading::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 20px;
      height: 20px;
      margin: -10px 0 0 -10px;
      border: 2px solid #f3f3f3;
      border-top: 2px solid #ff6b35;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 4rem 2rem;
      color: #6b7280;
    }
    
    .empty-state-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
    }
    
    .empty-state h3 {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
      color: #1f2937;
    }
    
    
    /* Responsive Design */
    @media (max-width: 768px) {
      .shop-hero h1 {
        font-size: 2.5rem;
      }
      
      .shop-hero p {
        font-size: 1.25rem;
      }
      
      .shop-stats {
        flex-direction: column;
        gap: 1.5rem;
      }
      
      .products-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }
      
      .products-header h2 {
        font-size: 2rem;
      }
      
      .product-actions {
        flex-direction: column;
      }
    }
    
    @media (max-width: 480px) {
      .shop-hero {
        padding: 60px 0 40px;
      }
      
      .shop-hero h1 {
        font-size: 2rem;
      }
      
      .products-section {
        padding: 40px 0;
      }
      
      .product-info {
        padding: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a class="logo" href="index.html"><img src="logo.png" alt="ATTRAL" style="height:32px; width:auto;" /></a>
      <nav class="nav">
        <a href="index.html">Home</a>
        <a href="shop.html" class="active">Shop</a>
        <a href="account.html">My Account</a>
        <a href="affiliates.html">Affiliate Central</a>
        <a href="contact.html">Contact Us</a>
        <div class="dropdown">
          <a href="#" class="dropdown-toggle" role="button" aria-haspopup="true" aria-expanded="false" aria-label="More menu">More ▾</a>
          <div class="dropdown-menu" role="menu" aria-labelledby="dropdown-toggle">
            <a href="about.html" role="menuitem">About Us</a>
            <a href="blog.html" role="menuitem">Blog</a>
            <a href="privacy.html" role="menuitem">Privacy</a>
            <a href="terms.html" role="menuitem">Terms</a>
          </div>
        </div>
        <a href="cart.html" class="cart-link">Cart <span id="cart-count" class="badge">0</span></a>
      </nav>
    </div>
  </header>

  <main>
    <!-- Shop Hero Section -->
    <section class="shop-hero">
      <div class="container">
        <h1>Discover Premium Electronics</h1>
        <p>Cutting-edge technology designed for modern life. From fast charging solutions to smart devices, find everything you need to power your lifestyle.</p>
        
        <div class="shop-stats">
          <div class="shop-stat">
            <span class="shop-stat-number" id="total-products">1</span>
            <span class="shop-stat-label">Premium Products</span>
          </div>
          <div class="shop-stat">
            <span class="shop-stat-number">100%</span>
            <span class="shop-stat-label">Quality Guaranteed</span>
          </div>
          <div class="shop-stat">
            <span class="shop-stat-number">Free</span>
            <span class="shop-stat-label">Shipping India</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Products Section -->
    <section class="products-section">
      <div class="container">
        <div class="products-header">
          <h2>Our Products</h2>
          <p>Carefully curated selection of premium electronics designed to enhance your daily life</p>
        </div>
        
        <div id="products-container" class="products-grid">
          <!-- Products will be loaded dynamically -->
        </div>
        
        <div id="empty-state" class="empty-state" style="display: none;">
          <div class="empty-state-icon">📦</div>
          <h3>No Products Available</h3>
          <p>We're working on adding more amazing products. Check back soon!</p>
        </div>
        
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container footer-inner">
      <div class="footer-content">
        <div class="footer-section">
          <h4>About ATTRAL</h4>
          <p>Smart Power. Smarter Living. We provide next-gen consumer electronics to power your lifestyle with cutting-edge GaN technology.</p>
          <div class="social-links">
            <a href="https://facebook.com/attral" target="_blank" rel="noopener" title="Follow us on Facebook">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
              </svg>
            </a>
            <a href="https://instagram.com/attral" target="_blank" rel="noopener" title="Follow us on Instagram">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 6.62 5.367 11.987 11.988 11.987s11.987-5.367 11.987-11.987C24.014 5.367 18.637.001 12.017.001zM8.449 16.988c-1.297 0-2.448-.49-3.323-1.297C4.198 14.895 3.708 13.744 3.708 12.447s.49-2.448 1.297-3.323c.875-.807 2.026-1.297 3.323-1.297s2.448.49 3.323 1.297c.807.875 1.297 2.026 1.297 3.323s-.49 2.448-1.297 3.323c-.875.807-2.026 1.297-3.323 1.297zm7.83-9.281H7.83c-.49 0-.89.4-.89.89v7.83c0 .49.4.89.89.89h8.449c.49 0 .89-.4.89-.89v-7.83c0-.49-.4-.89-.89-.89z"/>
              </svg>
            </a>
            <a href="https://twitter.com/attral" target="_blank" rel="noopener" title="Follow us on Twitter">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
              </svg>
            </a>
            <a href="https://linkedin.com/company/attral" target="_blank" rel="noopener" title="Connect on LinkedIn">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
              </svg>
            </a>
          </div>
        </div>
        <div class="footer-section">
          <h4>Quick Links</h4>
          <p><a href="index.html">Home</a></p>
          <p><a href="shop.html">Shop</a></p>
          <p><a href="about.html">About Us</a></p>
          <p><a href="contact.html">Contact</a></p>
        </div>
        <div class="footer-section">
          <h4>Support</h4>
          <p><a href="account.html">My Account</a></p>
          <p><a href="cart.html">Shopping Cart</a></p>
          <p><a href="affiliates.html">Affiliate Program</a></p>
          <p><a href="blog.html">Blog</a></p>
        </div>
        <div class="footer-section">
          <h4>Contact Info</h4>
          <p>📧 info@attral.in</p>
          <p>📱 +91 8903479870</p>
          <p>📍 Phase 2 Sathuvachari<br>Vellore - 632009<br>Tamil Nadu, India</p>
        </div>
      </div>
      <div class="footer-bottom">
        <p>© <span id="year"></span> ATTRAL. All rights reserved.</p>
        <nav>
          <a href="privacy.html">Privacy Policy</a>
          <a href="terms.html">Terms of Service</a>
          <a href="sitemap.xml">Sitemap</a>
        </nav>
      </div>
    </div>
  </footer>

  <script src="js/config.js"></script>
  <script src="js/app.js"></script>
  <script src="js/firebase.js"></script>
  <script src="js/dropdown.js"></script>
  
  <script>
    // Shop page functionality
    let products = [];
    
    // Wait for Firebase to be ready
    async function waitForFirebase() {
      let attempts = 0;
      const maxAttempts = 50;
      while (attempts < maxAttempts) {
        if (window.AttralFirebase && window.AttralFirebase.db) {
          return;
        }
        attempts++;
        await new Promise(r => setTimeout(r, 100));
      }
      throw new Error('Firebase failed to load');
    }
    
    // Load products from Firestore if available, else fallback to JSON
    async function loadProducts() {
      // Try Firebase first
      try {
        await waitForFirebase();
        if (window.AttralFirebase && window.AttralFirebase.db) {
          const snap = await window.AttralFirebase.db
            .collection('products')
            .orderBy('createdAt', 'desc')
            .get();
          const list = [];
          snap.forEach(doc => {
            const d = doc.data();
            list.push({
              id: d.id || doc.id,
              title: d.title || d.name || 'Unnamed Product',
              price: typeof d.price === 'number' ? d.price : parseFloat(d.price) || 0,
              description: d.description || '',
              category: d.category || 'General',
              image: d.image || d.imageUrl || 'assets/product_images/default.jpg',
              featured: !!d.featured
            });
          });
          products = list;
          renderProducts();
          updateStats();
          if (products.length === 0) {
            // Fallback to JSON if Firestore empty
            await loadProductsFromJsonFallback();
          }
          return;
        }
      } catch (e) {
        // Ignore and fallback
        console.warn('Firebase not ready for shop, falling back to JSON');
      }
      // Fallback to JSON file
      await loadProductsFromJsonFallback();
    }

    async function loadProductsFromJsonFallback() {
      try {
        const response = await fetch('data/products.json');
        products = await response.json();
        renderProducts();
        updateStats();
      } catch (error) {
        console.error('Error loading products (fallback):', error);
        showEmptyState();
      }
    }
    
    // Render products in the grid
    function renderProducts() {
      const container = document.getElementById('products-container');
      const emptyState = document.getElementById('empty-state');
      
      if (products.length === 0) {
        container.style.display = 'none';
        emptyState.style.display = 'block';
        return;
      }
      
      container.innerHTML = products.map(product => `
        <div class="product-card" data-product-id="${product.id}" onclick="viewProduct('${product.id}')">
          <div class="product-image-container">
            <img src="${product.image}" alt="${product.title}" class="product-image" />
            ${product.featured ? '<div class="product-badge">Featured</div>' : ''}
          </div>
          <div class="product-info">
            <div class="product-category">${product.category}</div>
            <h3 class="product-title">${product.title}</h3>
            <p class="product-description">${product.description}</p>
            <div class="product-price">₹${product.price.toLocaleString()}</div>
            <div class="product-features">
              <ul>
                ${product.features.slice(0, 3).map(feature => `<li>${feature}</li>`).join('')}
              </ul>
            </div>
            <div class="product-actions">
              <button class="btn-add-cart" onclick="event.stopPropagation(); addToCart('${product.id}')" type="button">
                🛒 Add to Cart
              </button>
              <button class="btn-view-details" onclick="event.stopPropagation(); viewProduct('${product.id}')" type="button">
                View Details
              </button>
            </div>
          </div>
        </div>
      `).join('');
    }
    
    // Update shop statistics
    function updateStats() {
      const totalProducts = document.getElementById('total-products');
      if (totalProducts) {
        totalProducts.textContent = products.length;
      }
    }
    
    // Show empty state
    function showEmptyState() {
      const container = document.getElementById('products-container');
      const emptyState = document.getElementById('empty-state');
      container.style.display = 'none';
      emptyState.style.display = 'block';
    }
    
    // Add product to cart with robust fallback and normalized IDs
    let addingToCart = new Set(); // Track products currently being added to prevent double-clicks
    
    function addToCart(productId) {
      // Prevent double-clicks
      if (addingToCart.has(productId)) {
        console.log('Already adding product to cart, ignoring duplicate click');
        return;
      }
      
      const product = products.find(p => String(p.id) === String(productId));
      if (!product) return;

      // Mark as being added
      addingToCart.add(productId);

      // Normalize to Firestore-style slug if the ID is numeric
      const idStr = String(productId || '');
      const isNumericId = /^\d+$/.test(idStr);
      const slugId = isNumericId && product.title
        ? product.title.toLowerCase().replace(/[^a-z0-9\s-]/g,'').replace(/\s+/g,'-').replace(/-+/g,'-').trim()
        : idStr;

      // Use centralized handler if available, otherwise fallback to localStorage
      if (window.Attral && typeof window.Attral.addToCart === 'function') {
        try { 
          window.Attral.addToCart(slugId); 
        } catch(e) { 
          console.error('Centralized addToCart failed, using fallback:', e);
          // Fallback to localStorage only if centralized fails
          addToCartFallback(slugId, product);
        }
      } else {
        // No centralized handler available, use localStorage fallback
        addToCartFallback(slugId, product);
      }
      updateCartCount();
      // Success - item added to cart silently
      
      // Clear the flag after a short delay to allow for normal clicking again
      setTimeout(() => {
        addingToCart.delete(productId);
      }, 1000);
    }
    
    // Fallback function for localStorage cart operations
    function addToCartFallback(slugId, product) {
      try {
        const key = 'attral_cart';
        const raw = localStorage.getItem(key);
        const cart = raw ? JSON.parse(raw) : [];
        const existing = cart.find(i => String(i.id) === String(slugId));
        if (existing) {
          existing.quantity = (existing.quantity || 1) + 1;
        } else {
          cart.push({ id: slugId, quantity: 1, price: product.price, title: product.title, image: product.image });
        }
        localStorage.setItem(key, JSON.stringify(cart));
      } catch (err) {
        console.error('Cart fallback failed:', err);
      }
    }
    
    function updateCartCount() {
      const el = document.getElementById('cart-count');
      if (!el) return;
      if (window.Attral && typeof window.Attral.getCartCount === 'function') {
        try {
          el.textContent = window.Attral.getCartCount();
          return;
        } catch {}
      }
      // Fallback from localStorage
      try {
        const raw = localStorage.getItem('attral_cart');
        const cart = raw ? JSON.parse(raw) : [];
        const count = cart.reduce((s, i) => s + (i.quantity || 1), 0);
        el.textContent = count;
      } catch {
        el.textContent = '0';
      }
    }
    
    // View product details - Direct navigation
    function viewProduct(productId) {
      console.log('viewProduct called with ID:', productId);
      const product = products.find(p => String(p.id) === String(productId));
      console.log('Found product:', product);
      
      if (product) {
        // Store product data in sessionStorage for the detail page
        sessionStorage.setItem('selectedProduct', JSON.stringify(product));
        console.log('Product stored in sessionStorage');
        
        // Navigate directly to product detail page
        const targetUrl = `product-detail.html?id=${productId}`;
        console.log('Navigating to:', targetUrl);
        
        // Use direct navigation - the product-detail.html will handle loading
        window.location.href = targetUrl;
      } else {
        console.error('Product not found with ID:', productId);
        // Product not found - handle silently
      }
    }
    
    
    
    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('year').textContent = new Date().getFullYear();
      if (window.Attral && typeof window.Attral.initHeaderCartCount === 'function') {
        window.Attral.initHeaderCartCount();
      } else {
        updateCartCount();
      }
      loadProducts();
      
      // Add event listeners for better compatibility
      document.addEventListener('click', function(e) {
        if (e.target.classList.contains('btn-view-details') || e.target.classList.contains('overlay-btn')) {
          const productId = e.target.getAttribute('onclick');
          if (productId && productId.includes('viewProduct')) {
            const id = productId.match(/viewProduct\((\d+)\)/);
            if (id) {
              e.preventDefault();
              viewProduct(parseInt(id[1]));
            }
          }
        }
      });
    });
    
    
  </script>
</body>
</html>
